<UserControl x:Class="LoneEftDmaRadar.UI.Radar.Views.LootListTab"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:LoneEftDmaRadar.UI.Radar.ViewModels"
             mc:Ignorable="d"
             d:DesignHeight="450"
             d:DesignWidth="600">

    <d:UserControl.DataContext>
        <d:DesignInstance Type="{x:Type vm:LootListViewModel}"
                          IsDesignTimeCreatable="False" />
    </d:UserControl.DataContext>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Row 0: Controls -->
        <StackPanel Orientation="Horizontal"
                    Margin="5"
                    Grid.Row="0">
            <TextBlock Text="Search:"
                       VerticalAlignment="Center"
                       Margin="0,0,5,0" />
            <TextBox Text="{Binding SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Delay=200}"
                     Width="200"
                     Margin="0,0,10,0"
                     VerticalAlignment="Center" />
            <TextBlock Text="Min Value:"
                       VerticalAlignment="Center"
                       Margin="0,0,5,0" />
            <TextBox Text="{Binding MinValue, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                     Width="80"
                     Margin="0,0,10,0"
                     VerticalAlignment="Center" />
            <Button Content="Refresh"
                    Command="{Binding RefreshCommand}"
                    Padding="10,2"
                    Margin="0,0,10,0" />
            <CheckBox Content="Auto-refresh"
                      IsChecked="{Binding AutoRefresh, Mode=TwoWay}"
                      VerticalAlignment="Center" />
        </StackPanel>

        <!-- Row 1: Loot Grid -->
        <DataGrid x:Name="LootGrid"
                  ItemsSource="{Binding FilteredLoot}"
                  AutoGenerateColumns="False"
                  Grid.Row="1"
                  Margin="5"
                  IsReadOnly="True"
                  EnableRowVirtualization="True"
                  EnableColumnVirtualization="True"
                  ScrollViewer.CanContentScroll="True"
                  VirtualizingStackPanel.IsVirtualizing="True"
                  VirtualizingStackPanel.VirtualizationMode="Recycling"
                  MouseDoubleClick="LootGrid_MouseDoubleClick"
                  SelectionMode="Single"
                  CanUserSortColumns="True"
                  Sorting="LootGrid_Sorting">

            <DataGrid.Columns>
                <DataGridTextColumn Header="Name"
                                    Binding="{Binding Name}"
                                    Width="*"
                                    SortMemberPath="Name" />

                <DataGridTextColumn Header="Value"
                                    Binding="{Binding FormattedPrice}"
                                    Width="80"
                                    SortMemberPath="Price">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="HorizontalAlignment" Value="Right" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridTextColumn Header="Distance"
                                    Binding="{Binding FormattedDistance}"
                                    Width="70"
                                    SortMemberPath="Distance">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="HorizontalAlignment" Value="Right" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridTextColumn Header="Type"
                                    Binding="{Binding ItemType}"
                                    Width="80" />
            </DataGrid.Columns>

            <DataGrid.RowStyle>
                <Style TargetType="DataGridRow">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsImportant}" Value="True">
                            <Setter Property="Foreground" Value="Red" />
                            <Setter Property="FontWeight" Value="Bold" />
                        </DataTrigger>
                        <DataTrigger Binding="{Binding IsQuestItem}" Value="True">
                            <Setter Property="Foreground" Value="Yellow" />
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.RowStyle>
        </DataGrid>

        <!-- Row 2: Status Bar -->
        <StackPanel Orientation="Horizontal"
                    Margin="5"
                    Grid.Row="2">
            <TextBlock Text="Total Items: " />
            <TextBlock Text="{Binding TotalItems}"
                       FontWeight="Bold"
                       Margin="0,0,15,0" />
            <TextBlock Text="Total Value: " />
            <TextBlock Text="{Binding TotalValue}"
                       FontWeight="Bold"
                       Foreground="LimeGreen" />
            <TextBlock Text="  |  Double-click to ping on radar"
                       FontStyle="Italic"
                       Foreground="Gray"
                       Margin="20,0,0,0" />
        </StackPanel>
    </Grid>
</UserControl>
