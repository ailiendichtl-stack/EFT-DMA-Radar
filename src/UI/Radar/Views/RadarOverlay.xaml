<UserControl x:Class="LoneEftDmaRadar.UI.Radar.Views.RadarOverlay"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:LoneEftDmaRadar.UI.Radar.ViewModels"
             mc:Ignorable="d"
             d:DesignHeight="450"
             d:DesignWidth="800">

    <!-- design‑time VM hookup -->
    <d:UserControl.DataContext>
        <d:DesignInstance Type="{x:Type vm:RadarOverlayViewModel}"
                          IsDesignTimeCreatable="False" />
    </d:UserControl.DataContext>

    <UserControl.Resources>
        <!-- converter to toggle Visibility -->
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
    </UserControl.Resources>

    <Grid>
        <!-- ─── top‑right toolbar ────────────────────────────────────────────── -->
        <StackPanel HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Margin="0,8,12,0">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,0,4">
                <ToggleButton x:Name="MapFreeToggle"
                              Content="{Binding MapFreeButtonText}"
                              IsChecked="{Binding IsMapFreeEnabled}"
                              Style="{StaticResource OverlayToggleButton}"
                              Margin="0,0,4,0" />
                <ToggleButton x:Name="LootToggle"
                              Visibility="{Binding IsLootButtonVisible, Converter={StaticResource BoolToVis}}"
                              Content="Loot"
                              IsChecked="{Binding IsLootOverlayVisible}"
                              Style="{StaticResource OverlayToggleButton}" />
            </StackPanel>

            <!-- Follow target indicator -->
            <Border Background="{DynamicResource App.SurfaceBrush}"
                    BorderBrush="{DynamicResource App.BorderBrush}"
                    BorderThickness="1"
                    Padding="10,6"
                    CornerRadius="6"
                    MinWidth="150"
                    HorizontalAlignment="Right"
                    Visibility="{Binding IsFollowTargetVisible, Converter={StaticResource BoolToVis}}">
                <TextBlock Text="{Binding FollowTargetInfo}"
                           Foreground="{DynamicResource App.TextPrimaryBrush}"
                           FontWeight="SemiBold"
                           FontSize="12" />
            </Border>
        </StackPanel>

        <!-- ─── in‑tree Loot overlay ─────────────────────────────────────────── -->
        <Border Background="{DynamicResource App.SurfaceBrush}"
                BorderBrush="{DynamicResource App.BorderBrush}"
                BorderThickness="1"
                Padding="12"
                CornerRadius="8"
                MinWidth="300"
                MaxWidth="420"
                Visibility="{Binding IsLootOverlayVisible, Converter={StaticResource BoolToVis}}"
                Panel.ZIndex="50"
                HorizontalAlignment="Right"
                VerticalAlignment="Top"
                Margin="0,44,12,0">
            <StackPanel>
                <TextBlock Text="Loot"
                           Foreground="{DynamicResource App.AccentBrush}"
                           FontWeight="Bold"
                           FontSize="14" />

                <TextBlock Text="Sort by Ruble Value"
                           Foreground="{DynamicResource App.TextPrimaryBrush}"
                           Margin="0,8,0,4" />

                <Grid Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="2*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="2*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0"
                               Text="Regular"
                               Foreground="{DynamicResource App.TextPrimaryBrush}"
                               VerticalAlignment="Center" />
                    <TextBox Grid.Column="1"
                             Text="{Binding RegularValue, UpdateSourceTrigger=PropertyChanged}"
                             MinWidth="100" />
                    <TextBlock Grid.Column="2"
                               Text="Valuable"
                               Foreground="{DynamicResource App.TextPrimaryBrush}"
                               VerticalAlignment="Center"
                               Margin="12,0,0,0" />
                    <TextBox Grid.Column="3"
                             Text="{Binding ValuableValue, UpdateSourceTrigger=PropertyChanged}"
                             MinWidth="100" />
                    <CheckBox Grid.Column="4"
                              Content="Price Per Slot"
                              IsChecked="{Binding PricePerSlot}"
                              Foreground="{DynamicResource App.TextPrimaryBrush}"
                              Margin="12,0,0,0" />
                </Grid>

                <StackPanel Orientation="Horizontal"
                            Margin="0,0,0,8">
                    <RadioButton Content="Flea Prices"
                                 ToolTip="Use flea market prices"
                                 IsChecked="{Binding IsFleaPrices, Mode=TwoWay}"
                                 GroupName="PriceSource"
                                 Foreground="{DynamicResource App.TextPrimaryBrush}" />
                    <RadioButton Content="Trader Prices"
                                 ToolTip="Use trader prices"
                                 IsChecked="{Binding IsTraderPrices, Mode=TwoWay}"
                                 GroupName="PriceSource"
                                 Foreground="{DynamicResource App.TextPrimaryBrush}"
                                 Margin="12,0,0,0" />
                </StackPanel>

                <WrapPanel Margin="0,0,0,8">
                    <CheckBox Content="Hide Corpses"
                              IsChecked="{Binding HideCorpses}"
                              Foreground="{DynamicResource App.TextPrimaryBrush}"
                              Margin="0,0,12,0" />
                    <CheckBox Content="Show Meds"
                              IsChecked="{Binding ShowMeds}"
                              Foreground="{DynamicResource App.TextPrimaryBrush}"
                              Margin="0,0,12,0" />
                    <CheckBox Content="Show Food"
                              IsChecked="{Binding ShowFood}"
                              Foreground="{DynamicResource App.TextPrimaryBrush}"
                              Margin="0,0,12,0" />
                    <CheckBox Content="Show Backpacks"
                              IsChecked="{Binding ShowBackpacks}"
                              Foreground="{DynamicResource App.TextPrimaryBrush}"
                              Margin="0,0,12,0" />
                    <CheckBox Content="Show Quest Items"
                              IsChecked="{Binding ShowQuestItems}"
                              Foreground="{DynamicResource App.TextPrimaryBrush}" />
                </WrapPanel>

                <TextBlock Text="Loot Search (ex: Item1,Item2,etc.)"
                           Foreground="{DynamicResource App.TextPrimaryBrush}"
                           Margin="0,8,0,4" />
                <TextBox Text="{Binding SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, Delay=300}"
                         HorizontalAlignment="Stretch" />
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
