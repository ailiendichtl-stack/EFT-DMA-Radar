<UserControl x:Class="LoneEftDmaRadar.UI.Radar.Views.DeviceAimbotTab"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:LoneEftDmaRadar.UI.Radar.ViewModels"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:converters="clr-namespace:LoneEftDmaRadar.UI.Converters"
             xmlns:conv="clr-namespace:LoneEftDmaRadar.UI.Misc"
             xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
             xmlns:controls="clr-namespace:LoneEftDmaRadar.UI.Controls"
             mc:Ignorable="d"
             Padding="10">
    <UserControl.Resources>
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter" />
        <conv:StringToColorConverter x:Key="StringToColorConverter" />
    </UserControl.Resources>

    <d:UserControl.DataContext>
        <d:DesignInstance Type="{x:Type vm:DeviceAimbotViewModel}" IsDesignTimeCreatable="False" />
    </d:UserControl.DataContext>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Orientation="Vertical" Margin="0,0,0,10">

            <!-- Device Connection card -->
            <GroupBox Header="Device Connection" Margin="0,0,0,8">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                        <TextBlock Text="Status:" FontWeight="Bold" Margin="0,0,8,0" VerticalAlignment="Center" />
                        <Ellipse Width="12" Height="12" VerticalAlignment="Center" Margin="0,0,8,0">
                            <Ellipse.Style>
                                <Style TargetType="Ellipse">
                                    <Setter Property="Fill" Value="#FFFF4444" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsConnected}" Value="True">
                                            <Setter Property="Fill" Value="#FF44FF44" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Ellipse.Style>
                        </Ellipse>
                        <TextBlock Text="{Binding ConnectionStatus}" VerticalAlignment="Center" />
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                        <TextBlock Text="Device Version:" FontWeight="Bold" Margin="0,0,8,0" VerticalAlignment="Center" />
                        <TextBlock Text="{Binding DeviceVersion}" VerticalAlignment="Center" />
                    </StackPanel>

                    <CheckBox Content="Use KMBox NET"
                              IsChecked="{Binding UseKmBoxNet, Mode=TwoWay}"
                              Margin="0,4,0,4" />

                    <StackPanel Margin="0,0,0,4" Visibility="{Binding UseKmBoxNet, Converter={StaticResource BoolToVis}}">
                        <TextBlock Text="KMBox NET IP / Port / MAC" FontWeight="Bold" Margin="0,0,0,4" />
                        <StackPanel Orientation="Horizontal">
                            <TextBox Text="{Binding KmBoxNetIp, Mode=TwoWay}" Width="140" Margin="0,0,8,0"/>
                            <TextBox Text="{Binding KmBoxNetPort, Mode=TwoWay}" Width="80" Margin="0,0,8,0"/>
                            <TextBox Text="{Binding KmBoxNetMac, Mode=TwoWay}" Width="120"/>
                        </StackPanel>
                    </StackPanel>

                    <CheckBox Content="Auto-connect on startup"
                              IsChecked="{Binding AutoConnect, Mode=TwoWay}"
                              Margin="0,4,0,4" />

                    <TextBlock Text="Available Devices:" FontWeight="Bold" Margin="0,4,0,4" />
                    <ComboBox ItemsSource="{Binding AvailableDevices}"
                              SelectedItem="{Binding SelectedDevice, Mode=TwoWay}"
                              Margin="0,0,0,8"
                              MinHeight="30">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding Port}" FontWeight="Bold" Margin="0,0,8,0"/>
                                    <TextBlock Text="-" Margin="0,0,8,0" Foreground="Gray"/>
                                    <TextBlock Text="{Binding Description}" Foreground="DarkGray"/>
                                </StackPanel>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>

                    <WrapPanel Margin="0,0,0,4">
                        <Button Content="Refresh Devices"
                                Command="{Binding RefreshDevicesCommand}"
                                MinWidth="120"
                                Height="35"
                                Margin="0,0,8,8"
                                IsEnabled="{Binding IsConnected, Converter={StaticResource InverseBooleanConverter}}" />
                        <Button Content="Connect"
                                Command="{Binding ConnectCommand}"
                                MinWidth="120"
                                Height="35"
                                Margin="0,0,8,8"
                                IsEnabled="{Binding IsConnected, Converter={StaticResource InverseBooleanConverter}}" />
                        <Button Content="Disconnect"
                                Command="{Binding DisconnectCommand}"
                                MinWidth="120"
                                Height="35"
                                Margin="0,0,8,8"
                                IsEnabled="{Binding IsConnected}" />
                    </WrapPanel>

                    <Button Content="Test Mouse Movement"
                            Command="{Binding TestMoveCommand}"
                            Padding="15,8"
                            ToolTip="Moves the mouse in a test pattern to verify the device is working. Device must be connected."
                            IsEnabled="{Binding IsConnected}"/>
                </StackPanel>
            </GroupBox>

            <!-- Hardware Aim card -->
            <GroupBox Header="Hardware Aim" Margin="0,0,0,8">
                <StackPanel>
                    <CheckBox Content="Enable Hardware Aimbot"
                              IsChecked="{Binding Enabled, Mode=TwoWay}"
                              FontWeight="SemiBold"
                              Margin="0,0,0,8" />

                    <TextBlock Text="{Binding Smoothing, StringFormat='Smoothing: {0:F1}x'}"
                               FontWeight="Bold"
                               Margin="0,0,0,4" />
                    <Slider Value="{Binding Smoothing, Mode=TwoWay}"
                            Minimum="1"
                            Maximum="8"
                            TickFrequency="0.1"
                            IsSnapToTickEnabled="True"
                            Margin="0,0,0,8" />

                    <TextBlock Text="{Binding HipfireSpeedFactor, StringFormat='Hipfire Speed: {0:P0}'}"
                               FontWeight="Bold"
                               Margin="0,0,0,4" />
                    <Slider Value="{Binding HipfireSpeedFactor, Mode=TwoWay}"
                            Minimum="0.1"
                            Maximum="1.0"
                            TickFrequency="0.1"
                            IsSnapToTickEnabled="True"
                            Margin="0,0,0,8" />

                    <TextBlock Text="{Binding PollingRateHz, StringFormat='Polling Rate: {0} Hz'}"
                               FontWeight="Bold"
                               Margin="0,0,0,4" />
                    <Slider Value="{Binding PollingRateHz, Mode=TwoWay}"
                            Minimum="30"
                            Maximum="1000"
                            TickFrequency="10"
                            IsSnapToTickEnabled="True"
                            Margin="0,0,0,8" />

                    <CheckBox Content="Enable Bullet Drop Prediction"
                              IsChecked="{Binding EnablePrediction, Mode=TwoWay}"
                              Margin="0,4,0,4" />

                    <CheckBox Content="Enable Lead Prediction (Moving Targets)"
                              IsChecked="{Binding EnableLeadPrediction, Mode=TwoWay}"
                              ToolTip="Predicts where moving targets will be. Disable if you prefer no horizontal compensation."
                              Margin="0,0,0,8" />

                    <TextBlock Text="{Binding DropCompensationFactor, StringFormat='Drop Compensation: {0:P0}'}"
                               FontWeight="Bold"
                               Margin="0,0,0,4" />
                    <Slider Value="{Binding DropCompensationFactor, Mode=TwoWay}"
                            Minimum="0.1"
                            Maximum="1.0"
                            TickFrequency="0.1"
                            IsSnapToTickEnabled="True"
                            Margin="0,0,0,8" />

                    <TextBlock Text="{Binding LeadCompensationFactor, StringFormat='Ballistic Lead: {0:F1}x'}"
                               FontWeight="Bold"
                               Margin="0,0,0,4"
                               ToolTip="Multiplier for bullet travel time lead. Only noticeable at long range." />
                    <Slider Value="{Binding LeadCompensationFactor, Mode=TwoWay}"
                            Minimum="0.5"
                            Maximum="3.0"
                            TickFrequency="0.1"
                            IsSnapToTickEnabled="True"
                            Margin="0,0,0,8" />

                    <TextBlock Text="{Binding DmaLatencyMs, StringFormat='DMA Latency: {0:F0} ms'}"
                               FontWeight="Bold"
                               Margin="0,0,0,4"
                               ToolTip="Extra lead time to compensate for DMA read delay. Start with 50-100ms and adjust." />
                    <Slider Value="{Binding DmaLatencyMs, Mode=TwoWay}"
                            Minimum="0"
                            Maximum="300"
                            TickFrequency="10"
                            IsSnapToTickEnabled="True"
                            Margin="0,0,0,4" />
                </StackPanel>
            </GroupBox>

            <!-- Targeting card -->
            <GroupBox Header="Targeting" Margin="0,0,0,8">
                <StackPanel>
                    <TextBlock Text="Target Bone" FontWeight="Bold" Margin="0,0,0,4" />
                    <ComboBox ItemsSource="{Binding AvailableBones}"
                              DisplayMemberPath="Name"
                              SelectedItem="{Binding SelectedBone, Mode=TwoWay}"
                              Margin="0,0,0,8" />

                    <TextBlock Text="Targeting Mode" FontWeight="Bold" Margin="0,0,0,4" />
                    <ComboBox SelectedIndex="{Binding TargetingMode, Mode=TwoWay}"
                              Margin="0,0,0,8">
                        <ComboBoxItem Content="Closest to Crosshair (FOV)" />
                        <ComboBoxItem Content="Closest Distance" />
                    </ComboBox>

                    <TextBlock Text="{Binding FOV, StringFormat='FOV: {0:F0}'}"
                               FontWeight="Bold"
                               Margin="0,0,0,4" />
                    <Slider Value="{Binding FOV, Mode=TwoWay}"
                            Minimum="10"
                            Maximum="500"
                            TickFrequency="10"
                            IsSnapToTickEnabled="True"
                            Margin="0,0,0,8" />

                    <TextBlock Text="{Binding MaxDistance, StringFormat='Max Distance: {0:F0}m'}"
                               FontWeight="Bold"
                               Margin="0,0,0,4" />
                    <Slider Value="{Binding MaxDistance, Mode=TwoWay}"
                            Minimum="50"
                            Maximum="800"
                            TickFrequency="50"
                            IsSnapToTickEnabled="True"
                            Margin="0,0,0,4" />

                    <CheckBox Content="Auto Target Switch"
                              IsChecked="{Binding AutoTargetSwitch, Mode=TwoWay}"
                              ToolTip="When enabled, automatically switches to next target when current becomes invalid."
                              Margin="0,4,0,0" />

                    <Separator Margin="0,8"/>

                    <CheckBox Content="Enable Hitscan (Visibility-Based Bone Selection)"
                              IsChecked="{Binding HitscanEnabled, Mode=TwoWay}"
                              FontWeight="SemiBold"
                              ToolTip="Dynamically selects the highest-priority shootable bone using ballistic LOS data from the Visibility system."
                              Margin="0,4,0,4" />

                    <StackPanel Visibility="{Binding HitscanEnabled, Converter={StaticResource BoolToVis}}"
                                Margin="16,0,0,0">

                        <TextBlock Text="Bone Priority (top = highest)"
                                   FontWeight="Bold" Margin="0,4,0,4" />
                        <ListBox ItemsSource="{Binding BonePriorityList}"
                                 SelectedItem="{Binding SelectedPriorityBone, Mode=TwoWay}"
                                 DisplayMemberPath="Name"
                                 Height="200"
                                 Margin="0,0,0,4" />

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <Button Content="Move Up"
                                    Command="{Binding MoveBoneUpCommand}"
                                    MinWidth="90" Height="28" Margin="0,0,8,0" />
                            <Button Content="Move Down"
                                    Command="{Binding MoveBoneDownCommand}"
                                    MinWidth="90" Height="28" />
                        </StackPanel>

                        <TextBlock Text="{Binding BoneHoldTimeMs, StringFormat='Grace Period: {0}ms'}"
                                   FontWeight="Bold" Margin="0,0,0,4"
                                   ToolTip="How long to hold the current bone after it loses visibility. Automatically shortened for fast-moving targets to prevent wall-tracking." />
                        <Slider Value="{Binding BoneHoldTimeMs, Mode=TwoWay}"
                                Minimum="25" Maximum="500"
                                TickFrequency="25" IsSnapToTickEnabled="True"
                                Margin="0,0,0,8" />

                        <TextBlock Text="{Binding BoneConfirmTimeMs, StringFormat='Confirm Time: {0}ms'}"
                                   FontWeight="Bold" Margin="0,0,0,4"
                                   ToolTip="A higher-priority bone must stay visible this long before the aimbot switches to it. Prevents jitter from brief visibility flickers." />
                        <Slider Value="{Binding BoneConfirmTimeMs, Mode=TwoWay}"
                                Minimum="25" Maximum="300"
                                TickFrequency="25" IsSnapToTickEnabled="True"
                                Margin="0,0,0,4" />
                    </StackPanel>
                </StackPanel>
            </GroupBox>

            <!-- FOV Circle card -->
            <GroupBox Header="FOV Circle" Margin="0,0,0,8">
                <StackPanel>
                    <CheckBox Content="Show FOV Circle on ESP"
                              IsChecked="{Binding ShowFovCircle, Mode=TwoWay}"
                              Margin="0,0,0,8" />

                    <WrapPanel Margin="0,0,0,4">
                        <TextBlock Text="Engaged Color:"
                                   VerticalAlignment="Center"
                                   Margin="0,0,8,0" />
                        <controls:NeonColorSwatch
                                          SelectedColor="{Binding FovCircleColorEngaged, Mode=TwoWay, Converter={StaticResource StringToColorConverter}}"
                                          ToolTip="Color when aimbot is actively engaged" />
                    </WrapPanel>

                    <WrapPanel Margin="0,0,0,0">
                        <TextBlock Text="Idle Color:"
                                   VerticalAlignment="Center"
                                   Margin="0,0,8,0" />
                        <controls:NeonColorSwatch
                                          SelectedColor="{Binding FovCircleColorIdle, Mode=TwoWay, Converter={StaticResource StringToColorConverter}}"
                                          ToolTip="Color when aimbot is not engaged" />
                    </WrapPanel>
                </StackPanel>
            </GroupBox>

            <!-- Target Filters card -->
            <GroupBox Header="Target Filters" Margin="0,0,0,8">
                <StackPanel>
                    <CheckBox Content="Target PMC Players"
                              IsChecked="{Binding TargetPMC, Mode=TwoWay}"
                              Margin="0,0,0,4" />
                    <CheckBox Content="Target Player Scavs"
                              IsChecked="{Binding TargetPlayerScav, Mode=TwoWay}"
                              Margin="0,0,0,4" />
                    <CheckBox Content="Target AI Scavs"
                              IsChecked="{Binding TargetAIScav, Mode=TwoWay}"
                              Margin="0,0,0,4" />
                    <CheckBox Content="Target Bosses"
                              IsChecked="{Binding TargetBoss, Mode=TwoWay}"
                              Margin="0,0,0,4" />
                    <CheckBox Content="Target Raiders"
                              IsChecked="{Binding TargetRaider, Mode=TwoWay}"
                              Margin="0,0,0,4" />
                    <CheckBox Content="Target Watchlist Players"
                              IsChecked="{Binding TargetSpecialPlayer, Mode=TwoWay}"
                              Margin="0,0,0,4" />
                    <CheckBox Content="Target Streamers"
                              IsChecked="{Binding TargetStreamer, Mode=TwoWay}"
                              Margin="0,0,0,0" />
                </StackPanel>
            </GroupBox>

        </StackPanel>
    </ScrollViewer>
</UserControl>
