<UserControl x:Class="LoneEftDmaRadar.UI.Controls.DraggablePanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:behaviors="clr-namespace:LoneEftDmaRadar.UI.Behaviors"
             mc:Ignorable="d"
             d:DesignWidth="400" d:DesignHeight="300"
             behaviors:DraggableBehavior.IsDraggable="True"
             behaviors:ResizableBehavior.IsResizable="True"
             behaviors:ResizableBehavior.MinWidth="280"
             behaviors:ResizableBehavior.MinHeight="200">

    <Border x:Name="PanelRoot"
            Background="{DynamicResource App.SurfaceBrush}"
            BorderBrush="{DynamicResource App.BorderBrush}"
            BorderThickness="1"
            CornerRadius="8">

        <!-- Drop shadow effect -->
        <Border.Effect>
            <DropShadowEffect Color="Black"
                              BlurRadius="20"
                              ShadowDepth="5"
                              Opacity="0.5"
                              Direction="270"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="36"/>
                <!-- Title bar -->
                <RowDefinition Height="*"/>
                <!-- Content -->
            </Grid.RowDefinitions>

            <!-- Title bar (drag handle - set in code-behind) -->
            <Border x:Name="TitleBar"
                    Grid.Row="0"
                    Background="{DynamicResource Panel.TitleBarBrush}"
                    CornerRadius="8,8,0,0">
                <Grid Margin="12,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Title -->
                    <TextBlock x:Name="TitleText"
                               Grid.Column="0"
                               Text="{Binding Title, RelativeSource={RelativeSource AncestorType=UserControl}}"
                               VerticalAlignment="Center"
                               FontWeight="SemiBold"
                               FontSize="13"
                               Foreground="{DynamicResource App.TextPrimaryBrush}"/>

                    <!-- Collapse and Close buttons -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <Button x:Name="CollapseButton"
                                Width="28"
                                Height="28"
                                Margin="0,0,4,0"
                                Padding="0"
                                VerticalAlignment="Center"
                                Click="CollapseButton_Click"
                                Style="{StaticResource PanelCloseButtonStyle}">
                            <TextBlock x:Name="CollapseSymbol" Text="−">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsCollapsed, RelativeSource={RelativeSource AncestorType=UserControl}}" Value="True">
                                                <Setter Property="Text" Value="+"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </Button>
                        <Button x:Name="CloseButton"
                                Content="✕"
                                Width="28"
                                Height="28"
                                Margin="0"
                                Padding="0"
                                VerticalAlignment="Center"
                                Click="CloseButton_Click"
                                Style="{StaticResource PanelCloseButtonStyle}"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Content area with ScrollViewer -->
            <Border x:Name="ContentBorder"
                    Grid.Row="1"
                    Background="{DynamicResource App.CardBrush}"
                    CornerRadius="0,0,8,8"
                    Visibility="{Binding IsCollapsed, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BoolToVisInverted}}">
                <ScrollViewer x:Name="ContentScrollViewer"
                              VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled"
                              Padding="0"
                              PreviewMouseWheel="ContentScrollViewer_PreviewMouseWheel">
                    <ContentPresenter x:Name="ContentArea"
                                      Content="{Binding PanelContent, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                      Margin="0"/>
                </ScrollViewer>
            </Border>

            <!-- Resize handle (bottom-right triangle) -->
            <Path x:Name="ResizeHandle"
                  Grid.Row="1"
                  HorizontalAlignment="Right"
                  VerticalAlignment="Bottom"
                  Margin="0,0,2,2"
                  Data="M 0 12 L 12 12 L 12 0 Z"
                  Fill="{DynamicResource Panel.ResizeHandleBrush}"
                  Opacity="0.6"
                  Cursor="SizeNWSE"
                  Visibility="{Binding IsCollapsed, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BoolToVisInverted}}">
                <Path.RenderTransform>
                    <RotateTransform Angle="0"/>
                </Path.RenderTransform>
            </Path>
        </Grid>
    </Border>
</UserControl>
