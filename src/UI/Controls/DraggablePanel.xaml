<UserControl x:Class="LoneEftDmaRadar.UI.Controls.DraggablePanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:behaviors="clr-namespace:LoneEftDmaRadar.UI.Behaviors"
             mc:Ignorable="d"
             d:DesignWidth="400" d:DesignHeight="300"
             behaviors:DraggableBehavior.IsDraggable="True"
             behaviors:ResizableBehavior.IsResizable="True"
             behaviors:ResizableBehavior.MinWidth="280"
             behaviors:ResizableBehavior.MinHeight="200">

    <!-- Layered structure: GlowLayer (Effect, no text) + ContentLayer (no Effect, ClearType preserved) -->
    <Grid x:Name="PanelRoot">
        <!-- Layer 0: Neon glow border (DropShadowEffect here — no text children, so ClearType unaffected) -->
        <Border CornerRadius="6"
                BorderBrush="{DynamicResource Neon.GlowBorderBrush}"
                BorderThickness="0.8"
                Background="Transparent">
            <Border.Effect>
                <DropShadowEffect Color="#9945FF"
                                  BlurRadius="20"
                                  ShadowDepth="0"
                                  Opacity="0.32"/>
            </Border.Effect>
        </Border>

        <!-- Layer 1: Content (no Effect — ClearType text rendering preserved) -->
        <Border Background="{DynamicResource Glass.SurfaceBrush}"
                BorderThickness="0.6"
                CornerRadius="6">
            <Border.BorderBrush>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#409945FF" Offset="0"/>
                    <GradientStop Color="#35E63366" Offset="1"/>
                </LinearGradientBrush>
            </Border.BorderBrush>

            <!-- Inner border: dark bottom/right edge for depth -->
            <Border BorderBrush="{DynamicResource Glass.BorderDarkBrush}"
                    BorderThickness="0,0,0.5,0.5"
                    CornerRadius="6">

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="32"/>
                        <!-- Title bar -->
                        <RowDefinition Height="*"/>
                        <!-- Content -->
                    </Grid.RowDefinitions>

                    <!-- Title bar (drag handle) -->
                    <Border x:Name="TitleBar"
                            Grid.Row="0"
                            Background="{DynamicResource Panel.TitleBarBrush}"
                            CornerRadius="6,6,0,0">

                        <!-- Neon bottom separator -->
                        <Border BorderThickness="0,0,0,0.5">
                            <Border.BorderBrush>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                    <GradientStop Color="#203B82F6" Offset="0"/>
                                    <GradientStop Color="#309945FF" Offset="0.5"/>
                                    <GradientStop Color="#20E63366" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.BorderBrush>
                            <Grid Margin="10,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Title with glow -->
                                <Grid Grid.Column="0" VerticalAlignment="Center">
                                    <!-- Glow layer (blurred duplicate — no ClearType needed) -->
                                    <TextBlock Text="{Binding Title, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                               FontWeight="SemiBold"
                                               FontSize="13"
                                               Foreground="{DynamicResource Neon.PinkBrush}"
                                               Opacity="0.55">
                                        <TextBlock.Effect>
                                            <BlurEffect Radius="6"/>
                                        </TextBlock.Effect>
                                    </TextBlock>
                                    <!-- Crisp text layer (no effect — ClearType preserved) -->
                                    <TextBlock x:Name="TitleText"
                                               Text="{Binding Title, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                               FontWeight="SemiBold"
                                               FontSize="13"
                                               Foreground="{DynamicResource Neon.PinkBrush}"/>
                                </Grid>

                                <!-- Collapse and Close buttons -->
                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <Button x:Name="CollapseButton"
                                            Width="24"
                                            Height="24"
                                            Margin="0,0,2,0"
                                            Padding="0"
                                            VerticalAlignment="Center"
                                            Click="CollapseButton_Click"
                                            Style="{StaticResource PanelCloseButtonStyle}">
                                        <TextBlock x:Name="CollapseSymbol" Text="&#x2212;" FontSize="11">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsCollapsed, RelativeSource={RelativeSource AncestorType=UserControl}}" Value="True">
                                                            <Setter Property="Text" Value="+"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </Button>
                                    <Button x:Name="CloseButton"
                                            Content="&#x2715;"
                                            Width="24"
                                            Height="24"
                                            Margin="0"
                                            Padding="0"
                                            VerticalAlignment="Center"
                                            Click="CloseButton_Click"
                                            Style="{StaticResource PanelCloseButtonStyle}"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </Border>

                    <!-- Content area with ScrollViewer -->
                    <Border x:Name="ContentBorder"
                            Grid.Row="1"
                            Background="{DynamicResource Glass.CardBrush}"
                            CornerRadius="0,0,6,6"
                            Visibility="{Binding IsCollapsed, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BoolToVisInverted}}">
                        <ScrollViewer x:Name="ContentScrollViewer"
                                      VerticalScrollBarVisibility="Auto"
                                      HorizontalScrollBarVisibility="Disabled"
                                      Padding="0"
                                      PreviewMouseWheel="ContentScrollViewer_PreviewMouseWheel">
                            <ContentPresenter x:Name="ContentArea"
                                              Content="{Binding PanelContent, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                              Margin="0"/>
                        </ScrollViewer>
                    </Border>

                    <!-- Resize handle (bottom-right triangle) -->
                    <Path x:Name="ResizeHandle"
                          Grid.Row="1"
                          HorizontalAlignment="Right"
                          VerticalAlignment="Bottom"
                          Margin="0,0,2,2"
                          Data="M 0 10 L 10 10 L 10 0 Z"
                          Fill="{DynamicResource Panel.ResizeHandleBrush}"
                          Opacity="0.4"
                          Cursor="SizeNWSE"
                          Visibility="{Binding IsCollapsed, RelativeSource={RelativeSource AncestorType=UserControl}, Converter={StaticResource BoolToVisInverted}}">
                        <Path.RenderTransform>
                            <RotateTransform Angle="0"/>
                        </Path.RenderTransform>
                    </Path>
                </Grid>
            </Border>
        </Border>
    </Grid>
</UserControl>
